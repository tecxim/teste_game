<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Batalha Naval Arcade - Emojis & Ondas</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: linear-gradient(to bottom, #000428, #004e92);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            user-select: none;
        }

        #hud {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 12px 20px;
            border-radius: 12px;
            border: 2px solid rgba(0, 170, 255, 0.5);
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.3);
            font-size: 18px;
            color: #0af;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
            z-index: 100;
        }

        #hud span {
            font-weight: bold;
            color: #ffeb3b;
        }

        #messageBox {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 30, 0.95);
            padding: 30px 50px;
            border-radius: 16px;
            border: 2px solid rgba(0, 170, 255, 0.7);
            box-shadow: 0 0 30px rgba(0, 170, 255, 0.5);
            text-align: center;
            font-size: 28px;
            display: none;
            z-index: 100;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }

        #messageBox button {
            margin-top: 20px;
            padding: 12px 30px;
            font-size: 18px;
            background: rgba(0, 170, 255, 0.8);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 170, 255, 0.5);
        }

        #messageBox button:hover {
            background: rgba(0, 170, 255, 1);
            box-shadow: 0 0 20px rgba(0, 170, 255, 0.8);
        }

        canvas {
            display: block;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
            margin: 20px auto;
            background: rgba(0, 0, 20, 0.3);
        }
    </style>
</head>
<body>
    <div id="hud">
        Fase: <span id="fase">1</span> |
        Pontos: <span id="score">0</span> |
        Vidas: <span id="vidas">3</span>
    </div>
    <canvas id="gameCanvas" width="950" height="600"></canvas>
    <div id="messageBox">
        <div id="messageText"></div>
        <button onclick="restartGame()">Jogar Novamente</button>
    </div>
    <script>
        // ---------------------------------------------
        // CONFIG DO JOGO
        // ---------------------------------------------
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        let keys = {};
        let tirosJogador = [];
        let tirosInimigos = [];
        let barcos = [];
        let score = 0;
        let vidas = 3;
        let faseAtual = 0;
        let jogoAtivo = true;

        // Emojis dos barcos
        const inimigos = ["ðŸš¤", "â›µ", "ðŸ›¥ï¸", "ðŸš¢"];
        const jogadorEmoji = "ðŸš¢";

        // Player
        const player = {
            x: canvas.width / 2 - 30,
            y: 480,
            size: 60,
            speed: 5
        };

        // Ondas animadas
        let ondaOffset = 0;

        // Fases do jogo
        const fases = [
            { fundo: "rgba(0, 0, 20, 0.3)", velocidadeBarcos: 1, quantidadeBarcos: 1, faseFinal: false },
            { fundo: "rgba(0, 20, 40, 0.4)", velocidadeBarcos: 1.5, quantidadeBarcos: 2, faseFinal: false },
            { fundo: "rgba(0, 40, 60, 0.5)", velocidadeBarcos: 2, quantidadeBarcos: 3, faseFinal: false },
            { fundo: "rgba(40, 0, 60, 0.6)", velocidadeBarcos: 2.5, quantidadeBarcos: 5, faseFinal: true }
        ];

        // ---------------------------------------------
        // CONTROLES
        // ---------------------------------------------
        document.addEventListener("keydown", e => keys[e.key] = true);
        document.addEventListener("keyup", e => keys[e.key] = false);

        // ---------------------------------------------
        // SONS
        // ---------------------------------------------
        function beep(freq, dur=0.1) {
            let ctxA = new AudioContext();
            let o = ctxA.createOscillator();
            let g = ctxA.createGain();
            o.connect(g);
            g.connect(ctxA.destination);
            o.frequency.value = freq;
            o.type = "square";
            o.start();
            g.gain.exponentialRampToValueAtTime(0.0001, ctxA.currentTime + dur);
            o.stop(ctxA.currentTime + dur);
        }

        // ---------------------------------------------
        // GERAR BARCO EMOJI
        // ---------------------------------------------
        function gerarBarco() {
            const fase = fases[faseAtual];
            for (let i = 0; i < fase.quantidadeBarcos; i++) {
                barcos.push({
                    emoji: inimigos[Math.floor(Math.random() * inimigos.length)],
                    x: Math.random() * (canvas.width - 60),
                    y: -80,
                    size: 60,
                    speed: fase.velocidadeBarcos,
                    podeAtirar: Math.random() < 0.3 // 30% de chance de atirar
                });
            }
        }

        // ---------------------------------------------
        // TIROS DO JOGADOR
        // ---------------------------------------------
        function atirarJogador() {
            tirosJogador.push({
                x: player.x + player.size/2 - 5,
                y: player.y - 10,
                w: 10,
                h: 18,
                speed: 7
            });
            beep(250, 0.05);
        }

        // ---------------------------------------------
        // TIROS DOS INIMIGOS
        // ---------------------------------------------
        function atirarInimigo(barco) {
            tirosInimigos.push({
                x: barco.x + barco.size/2 - 5,
                y: barco.y + barco.size,
                w: 10,
                h: 18,
                speed: 5
            });
        }

        // ---------------------------------------------
        // COLISÃƒO AABB
        // ---------------------------------------------
        function colide(a, b) {
            return a.x < b.x + b.size &&
                   a.x + a.w > b.x &&
                   a.y < b.y + b.size &&
                   a.y + a.h > b.y;
        }

        // ---------------------------------------------
        // DESENHAR FUNDO
        // ---------------------------------------------
        function desenharFundo() {
            const fase = fases[faseAtual];
            ctx.fillStyle = fase.fundo;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = "rgba(0, 170, 255, 0.7)";
            ctx.lineWidth = 3;

            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                for (let x = 0; x < canvas.width; x++) {
                    let y = 10 * Math.sin((x * 0.02) + ondaOffset + i) + 200 + i*80;
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
        }

        // ---------------------------------------------
        // UPDATE DO JOGO
        // ---------------------------------------------
        function update() {
            if (!jogoAtivo) return;

            // Movimentos do jogador
            if (keys["ArrowLeft"] && player.x > 0) player.x -= player.speed;
            if (keys["ArrowRight"] && player.x < canvas.width - player.size) player.x += player.speed;
            if (keys["ArrowUp"] && player.y > 0) player.y -= player.speed;
            if (keys["ArrowDown"] && player.y < canvas.height - player.size) player.y += player.speed;

            // Tiros do jogador
            tirosJogador.forEach(t => t.y -= t.speed);
            tirosJogador = tirosJogador.filter(t => t.y > -20);

            // Tiros dos inimigos
            tirosInimigos.forEach(t => t.y += t.speed);
            tirosInimigos = tirosInimigos.filter(t => t.y < canvas.height + 20);

            // Barcos inimigos
            barcos.forEach(barco => {
                barco.y += barco.speed;

                // 30% de chance de atirar
                if (barco.podeAtirar && Math.random() < 0.01) {
                    atirarInimigo(barco);
                }
            });

            barcos = barcos.filter(barco => barco.y < canvas.height + 100);

            // ColisÃ£o tiro do jogador / barco inimigo
            for (let i = barcos.length - 1; i >= 0; i--) {
                for (let j = tirosJogador.length - 1; j >= 0; j--) {
                    if (colide(tirosJogador[j], barcos[i])) {
                        score += 10;
                        beep(600, 0.1);
                        barcos.splice(i, 1);
                        tirosJogador.splice(j, 1);
                        break;
                    }
                }
            }

            // ColisÃ£o tiro inimigo / jogador
            for (let i = tirosInimigos.length - 1; i >= 0; i--) {
                if (colide(tirosInimigos[i], player)) {
                    vidas--;
                    beep(120, 0.2);
                    tirosInimigos.splice(i, 1);
                    if (vidas <= 0) fimDeJogo(false);
                }
            }

            // ColisÃ£o barco inimigo / jogador
            for (let i = barcos.length - 1; i >= 0; i--) {
                if (colide(
                    {x: player.x, y: player.y, w: player.size, h: player.size},
                    {x: barcos[i].x, y: barcos[i].y, w: barcos[i].size, h: barcos[i].size}
                )) {
                    vidas--;
                    beep(120, 0.2);
                    barcos.splice(i, 1);
                    if (vidas <= 0) fimDeJogo(false);
                }
            }

            // AvanÃ§ar de fase
            if (barcos.length === 0 && faseAtual < fases.length - 1) {
                faseAtual++;
                document.getElementById("fase").textContent = faseAtual + 1;
                gerarBarco();
            }

            // VitÃ³ria
            if (faseAtual === fases.length - 1 && barcos.length === 0) {
                fimDeJogo(true);
            }

            // HUD
            document.getElementById("score").textContent = score;
            document.getElementById("vidas").textContent = vidas;
        }

        // ---------------------------------------------
        // DESENHAR
        // ---------------------------------------------
        function draw() {
            desenharFundo();

            // Player
            ctx.font = "60px Arial";
            ctx.textAlign = "left";
            ctx.fillStyle = "white";
            ctx.fillText(jogadorEmoji, player.x, player.y + 50);

            // Inimigos
            barcos.forEach(barco => {
                ctx.font = "60px Arial";
                ctx.fillStyle = "white";
                ctx.fillText(barco.emoji, barco.x, barco.y + 50);
            });

            // Tiros do jogador
            ctx.fillStyle = "#ffeb3b";
            tirosJogador.forEach(t => {
                ctx.beginPath();
                ctx.arc(t.x + t.w/2, t.y + t.h/2, t.w/2, 0, Math.PI * 2);
                ctx.fill();
            });

            // Tiros dos inimigos
            ctx.fillStyle = "red";
            tirosInimigos.forEach(t => {
                ctx.beginPath();
                ctx.arc(t.x + t.w/2, t.y + t.h/2, t.w/2, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // ---------------------------------------------
        // LOOP
        // ---------------------------------------------
        let spawnTimer = 0;

        function gameLoop() {
            update();
            draw();
            spawnTimer++;
            if (spawnTimer > 120) {
                gerarBarco();
                spawnTimer = 0;
            }
            requestAnimationFrame(gameLoop);
        }

        // ---------------------------------------------
        // FIM DE JOGO
        // ---------------------------------------------
        function fimDeJogo(vitoria) {
            jogoAtivo = false;
            const msg = document.getElementById("messageText");
            msg.innerHTML = vitoria
                ? "ðŸŽ‰ VOCÃŠ VENCEU!<br>PontuaÃ§Ã£o: " + score
                : "ðŸ’€ DERROTA!<br>PontuaÃ§Ã£o: " + score;
            document.getElementById("messageBox").style.display = "block";
        }

        // ---------------------------------------------
        // REINICIAR
        // ---------------------------------------------
        function restartGame() {
            tirosJogador = [];
            tirosInimigos = [];
            barcos = [];
            score = 0;
            vidas = 3;
            faseAtual = 0;
            player.x = canvas.width/2 - 30;
            player.y = 480;
            jogoAtivo = true;
            document.getElementById("messageBox").style.display = "none";
            document.getElementById("fase").textContent = faseAtual + 1;
            gerarBarco();
        }

        // ---------------------------------------------
        // CONTROLE DE TIRO DO JOGADOR
        // ---------------------------------------------
        document.addEventListener("keydown", e => {
            if (e.key === " ") atirarJogador();
        });

        // Iniciar
        gerarBarco();
        gameLoop();
    </script>
</body>
</html>
